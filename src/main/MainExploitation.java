package main;

	import ia.Exploitation;
import lejos.nxt.Button;
import model.Grid;
import model.Position;
import captors.ExtendedMovement;
import captors.LineObserver;
import captors.WallDetector;

		
public class MainExploitation extends AbstractMain {

		public MainExploitation(Grid g, Position pos) {
			super(g, pos);
		}
		
		public void start () {
			ExtendedMovement move = new ExtendedMovement(this.pos);
			
			WallDetector wd = new WallDetector(this.pos);
			wd.changeHeadPosition(); // Met vers l'avant
			Thread wdThread = new Thread(wd);
			wdThread.start();/**/
			wd.addObserver(move);
			
			this.ldThread.start();
			LineObserver lo = new LineObserver(move, this.pos);
			this.ld.addObserver(lo);	
			
			Exploitation exploit = new Exploitation(this.pos, this.grid, move);
			exploit.solve();/**/
			
			this.ld.stop();
			wd.stop();
			
			System.out.println("Before join");
			try {
				this.ldThread.join();
				System.out.println("After join 1");
				wdThread.join();
				System.out.println("After join 2");
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			}
			
			if (wd.isInFrontPosition())
				wd.changeHeadPosition();/**/
			
			Button.waitForAnyPress();
		}

	}

