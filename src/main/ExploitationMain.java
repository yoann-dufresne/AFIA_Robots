package main;

	import ia.Exploitation;

import java.awt.Point;

import lejos.nxt.Button;
import model.Grid;
import model.Position;
import captors.ExtendedMovement;
import captors.LineObserver;
import captors.WallDetector;
import captors.WallDiscovererObserver;

		
public class ExploitationMain extends AbstractMain {

		public ExploitationMain(Position pos, Grid g) {
			super(pos, g);
		}
		
		public void start () {
			Point destination = new Point(5,10);
			ExtendedMovement move = new ExtendedMovement(this.pos);
			
			WallDetector wd = new WallDetector();
			wd.changeHeadPosition(); // Met vers l'avant
			Thread wdThread = new Thread(wd);
			wdThread.start();/**/
			
			LineObserver lo = new LineObserver(move, this.pos);
			this.ld.addObserver(lo);

			WallDiscovererObserver wo = new WallDiscovererObserver(this.grid, this.pos);
			wd.addObserver(wo);/**/
			

			Exploitation exploit= new Exploitation(this.pos, this.grid, move);
			exploit.solve(destination);
			
			this.ld.stop();
			wd.stop();
			
			try {
				ldThread.join();
				wdThread.join();
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			}
			
			if (wd.isInFrontPosition())
				wd.changeHeadPosition();/**/
			
			Button.waitForAnyPress();
		}

	}

